package LeetCode.March;

import java.util.Arrays;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;


public class NumOfTrees {
	
	public static class FIndex{
		int index;
		int factor;
		int fIndex;
		public FIndex(int index, int factor, int fIndex) {
			this.index = index;
			this.factor = factor;
			this.fIndex = fIndex;
		}
	}

	

	public static void main(String[] args) {
		// TODO Auto-generated method stub

		 
		long start = System.nanoTime();
		//System.out.println(numFactoredBinaryTrees(new int[] {820405493,328584463,256634311,352758970,904067863,303079568,785158205,693121840,449885677,511606208,909610468,595560791,62946358,881631143,277319547,110948820,901074512,228027493,593820680,460221520,492449389,978822353,799682701,604601805,991931265,496970272,987091281,238789022,442057444,483940090,324722848,615204236,338155459,824638876,249047516,857885434,480329252,460312517,760322979,260554395,199741982,860583527,874782009,684921745,9874912,26252077,573333268,608378669,22602062,921572582,931448580,612263045,851247326,806647773,906512123,977434433,193096335,95472048,981639014,918063622,601170822,301884526,553055121,8285233,37325497,640879231,528833090,667288415,759511763,774428472,296750575,646178014,345995145,256961919,877353780,550872573,533090871,874866864,159982267,846862815,491870026,895866695,796292048,255031316,575463851,947392404,31975830,456484989,522080080,882833550,581652407,370887536,95803434,158969753,522373642,45396224,342327710,555152094,102291517,986975104,32445874,703028352,935451519,558281818,831049908,300369795,625956251,284450060,839699458,380705523,942930888,478484488,709758729,683580188,308310532,92378018,488956488,290284209,384140314,247941357,479144012,861342318,527176323,64565975,414885500,78295583,682936485,960860375,131415247,795819931,405862491,276456575,542806278,924989787,885625966,989360560,128577306,962308795,462776481,935773721,886048641,302317769,710521096,454726081,893119879,605470636,524836239,137532807,780181002,3968439,983996291,587122741,323189471,981003172,856549988,601826067,763369180,659177220,469672934,408207139,996817860,47048271,519578288,230451757,600719269,38001682,796342243,723662997,950000343,537820094,108184352,627940515,902000735,268787810,319654550,535034852,136899901,783189481,775433455,107757833,321990347,437424656,123497539,377426608,80252486,808490918,540681206,850095533,923718069,498250061,768584197,795572904,63330466,455294361,447009635,712346802,313456177,315642460,696228723,760487625,69085799,767445900,46832519,735637975,762586022,521018561,478811629,265492308,519050082,668006729,75213932,874063370,76886050,676368121,591410865,246486908,618742851,753380410,719229988,85679580,423514387,787286992,432517211,884602588,347264974,960072868,443195567,317739038,678695264,629922650,744445038,543406606,204099720,485548232,569523681,183742387,874995249,919446535,890414702,318072502,900948167,615166633,62205327,186990980,615258491,95825354,622218890,668985342,234010242,419387520,785748907,177956194,620285742,480532558,329142476,347390499,299119439,541998800,159993468,376048917,747392429,710452856,511773915,974226423,706027565,110847534,788137827,800324267,769047925,903952104,878741530,900237540,853881107,346338806,604023373,192465079,924068945,887351485,286983017,194952212,505866789,801275381,502597340,424839379,193269719,115539281,202568276,122849348,127582207,100166896,675135164,669111602,683385448,680461791,81356634,29649404,579127380,578248935,906659054,817344253,416487848,750229846,441209701,832027958,927634351,307136245,631230272,282039710,387002264,780060082,186662907,402565686,682131048,104762741,191432047,516772401,948020460,169583186,743307600,833834608,236660298,881777779,473526166,684681415,313188951,586690231,881940630,742986994,880712190,947188861,78590437,539674281,626887498,187523412,614876105,349469177,407808900,950295467,33486108,529712917,813733268,173295371,946368477,640448730,213346902,597809083,813723622,274546015,519535820,977695811,315462313,416814810,922366583,677409078,939326232,873148049,667805289,79330914,683439801,590079830,123330183,464946358,807759911,277898703,778673872,852620522,501033743,799000382,485740594,124346426,933457136,156808284,189043288,667618243,765409908,891713046,364191704,920062739,285606750,16413165,234261744,466647962,55170234,489117958,490447633,748221043,968370015,414616873,182799031,199326587,923407746,703819922,540007261,491209796,90042085,54046635,565895163,855899946,680690616,998848808,472385218,570297133,579429455,109400152,507994450,671316857,899530031,631744449,308990577,28357042,201025030,674825858,456186438,816633502,730845087,505857967,837852771,808307827,741285777,706559561,172463002,762256352,522878986,757560022,507904056,135899098,659085900,213172902,549634478,426888416,968121377,990359892,884054863,745331084,230691766,515385807,542327926,538996317,663149043,783592825,740048339,176979838,527090982,666971685,157469244,790212337,474078040,434108239,602651757,484812863,214657842,154173526,216340523,170028325,435101645,368610788,122759895,41204656,445331767,372904194,903749994,687217037,894574981,618926267,111870873,218838443,193267727,985965955,11066716,621103991,797911973,334170198,732217895,33398979,568497710,192784753,866915821,259089827,15902587,770148746,236118030,856184351,426136903,72178411,706550026,487789134,133559625,523100392,495368580,219229584,714875685,14625524,958520714,446000520,549533484,92896351,649267089,282403019,758381897,909018848,470520493,97140491,623796382,460375041,308334602,62354698,321794506,732113856,298228167,503688443,379006120,313759014,618104377,246161849,815502984,244821956,94817923,1007046,109003604,678370657,392689051,574321629,808513378,321036776,521985293,505832425,328406537,946617148,734136102,352567382,338401963,856741764,349479705,454812492,933986218,874254532,345054817,816171412,925982917,761184502,129196101,98746822,908830270,705930364,204326996,14975977,862647910,521153606,874919428,147896020,496496651,284498566,164087669,366515875,1343654,100560128,267597025,841374109,417193598,54121040,657390251,636047524,442309712,863262266,678177313,619275152,191500589,407957810,195827305,901588834,346507205,201007009,945287781,840452167,538708867,6420140,291786648,487947777,346048538,694570427,658439554,83710320,477258503,728694097,711442909,26138319,629210339,648518261,240781743,390161104,326306465,420939685,824782284,112377245,674606569,604761528,689758899,329377791,359541131,561983313,656446731,208526898,272178606,971816494,296420375,185858171,432561156,626797438,738081786,99853218,419173799,572668734,398268938,737260533,723080455,29260722,998538801,129645809,658799560,812696530,833267350,350882719,186448232,701643753,918835603,316981604,134522500,218381716,185147503,186159632,964591814,187328176,197914206,231945427,938719419,668260834,870877909,723704501,382310604,70062216,126336312,611411299,779711153,820502807,648690867,794093934,979917870,578687803,357578941,7901364,608404135,129240271,334163583,323347279,147891840,116090623,348806141,870902525,869805877,765262902,833726883,104894402,578512434,349733094,970648873,689395941,825769204,278015090,37687163,475234920,592577755,963176880,599756686,109659376,500795250,917483319,423592804,191082099,171730514,245950681,645976410,21511750,251615322,566596133,359014807,443596700,551170080,843274995,68790450,135541795,725412657,985451847,336300314,958368861,585396319,641589903,33207072,129858370,148347171,347899801,607129156,495137711,794301730,594362903,462717368,708969018,45260287,497894730,734951236,21057356,682987441,872278382,213686825,570301643,29630065,645176153,557716789,452835051,501155486,889606349,135610634,144909566,709060900,245944495,495918066,724241267,344809282,961068346,900469376,119803250,849085452,897727010,77904130,656194655,120494975,850014841,225369449,225251133,220578396,855300476,885855307,373686115,674379911,531622982,644871113,887939173,598851125,814894184,141687210,519818338,942643209,414267577,944310607,628091289,143089275,474131866,215756835,200116603,785791210,323245796,911806412,901737679,929452610,806551850,292812694,840962996,560994796,620847955,774652691,745624937,956399543,863665447,330750072,120248428,712786270,857173442,93292028,685728293,94050285,71364678,641440031,799787471,231370351,619511764,71762418,949998664,231764234,179051642,671518903,596035126,598127170,446996876,103551896,461880158,896521245,938745517,802301139,19114290,228711685,68280832,842567174,355507878,945733317,73920840,779492039,629904695,911882411,749398718,38196679,770498433,713561766,101075601,426834800,845098717,101472749,333216277,731315775,998163420,379762822,431908670,664300437,489817427,210393061,683292097,928218053,679608977,663291066,523027552,941195170,76054738,163811195,142716320,691592790,126234135,409959611,810741875,212724097,45340925,127816808,772912535,354863141,658380187,749240213,813114885,751330324,588897589,224519488,227844587,963043094,506064211,987730325,610389428,183606770,587225913,424305877,867771836,580084580,426028717,667449438,22223374,779752720,37166776,22334463,905966471,880324113,230133209,203317125,710600742,381844616,354715626,442038216,512799329,819465847,250263176,76240775,230497850,936906729,2002414,842010363,342493969,844418509,10799920,236957011,529926807,604718589,954402574,939776002,17738468,89240898,242863241,230661480,112330247,665127521,844573935,494175551,380447921,292216596,247402329,813807911,668288740,767941241,4000673,292486048,971699491,199524320,258012395,754506197,777832374,733829948,898249098,286133825,729829851,608118205,969574395,257727380,935914859,43484816,514935550,258791679,393109519,320709758,236577274,533085803,553483120,212964341,205990835,478620820,152965986,715701258,431434296,837203608,836676297,65937777,320637289,228300675,869330050,169799899,838900213,75268272,220160222,816815051,486755785,473847121,649000019,353787659,526427474,116448311,787199445,540025875,466279157,29867994,305634345,566230257,910235570,218928636,156353791,304053339,101131674,99473649,695403656,423371198,310502594,77967335,163619045,480245016,710540930,258752186,91245542,450504415,172651747,830953435,176672914,85042831,769853742,12690518,24946884,808758446,240968880,12230668,126738959,422174738,649018255,638054541,814265036,228713071,90911699,175689310,484968366,658106493,492381692,962446206,711316398,529145963,526113125,583379961,888620877,688141417,109880025,152939931,235320152}));
		long end = System.nanoTime();
		System.out.println((end - start)/1000000 + " milliseconds");
		
		
		/*
		
		int[] test = new int[] {820405493,328584463,256634311,352758970,904067863,303079568,785158205,693121840,449885677,511606208,909610468,595560791,62946358,881631143,277319547,110948820,901074512,228027493,593820680,460221520,492449389,978822353,799682701,604601805,991931265,496970272,987091281,238789022,442057444,483940090,324722848,615204236,338155459,824638876,249047516,857885434,480329252,460312517,760322979,260554395,199741982,860583527,874782009,684921745,9874912,26252077,573333268,608378669,22602062,921572582,931448580,612263045,851247326,806647773,906512123,977434433,193096335,95472048,981639014,918063622,601170822,301884526,553055121,8285233,37325497,640879231,528833090,667288415,759511763,774428472,296750575,646178014,345995145,256961919,877353780,550872573,533090871,874866864,159982267,846862815,491870026,895866695,796292048,255031316,575463851,947392404,31975830,456484989,522080080,882833550,581652407,370887536,95803434,158969753,522373642,45396224,342327710,555152094,102291517,986975104,32445874,703028352,935451519,558281818,831049908,300369795,625956251,284450060,839699458,380705523,942930888,478484488,709758729,683580188,308310532,92378018,488956488,290284209,384140314,247941357,479144012,861342318,527176323,64565975,414885500,78295583,682936485,960860375,131415247,795819931,405862491,276456575,542806278,924989787,885625966,989360560,128577306,962308795,462776481,935773721,886048641,302317769,710521096,454726081,893119879,605470636,524836239,137532807,780181002,3968439,983996291,587122741,323189471,981003172,856549988,601826067,763369180,659177220,469672934,408207139,996817860,47048271,519578288,230451757,600719269,38001682,796342243,723662997,950000343,537820094,108184352,627940515,902000735,268787810,319654550,535034852,136899901,783189481,775433455,107757833,321990347,437424656,123497539,377426608,80252486,808490918,540681206,850095533,923718069,498250061,768584197,795572904,63330466,455294361,447009635,712346802,313456177,315642460,696228723,760487625,69085799,767445900,46832519,735637975,762586022,521018561,478811629,265492308,519050082,668006729,75213932,874063370,76886050,676368121,591410865,246486908,618742851,753380410,719229988,85679580,423514387,787286992,432517211,884602588,347264974,960072868,443195567,317739038,678695264,629922650,744445038,543406606,204099720,485548232,569523681,183742387,874995249,919446535,890414702,318072502,900948167,615166633,62205327,186990980,615258491,95825354,622218890,668985342,234010242,419387520,785748907,177956194,620285742,480532558,329142476,347390499,299119439,541998800,159993468,376048917,747392429,710452856,511773915,974226423,706027565,110847534,788137827,800324267,769047925,903952104,878741530,900237540,853881107,346338806,604023373,192465079,924068945,887351485,286983017,194952212,505866789,801275381,502597340,424839379,193269719,115539281,202568276,122849348,127582207,100166896,675135164,669111602,683385448,680461791,81356634,29649404,579127380,578248935,906659054,817344253,416487848,750229846,441209701,832027958,927634351,307136245,631230272,282039710,387002264,780060082,186662907,402565686,682131048,104762741,191432047,516772401,948020460,169583186,743307600,833834608,236660298,881777779,473526166,684681415,313188951,586690231,881940630,742986994,880712190,947188861,78590437,539674281,626887498,187523412,614876105,349469177,407808900,950295467,33486108,529712917,813733268,173295371,946368477,640448730,213346902,597809083,813723622,274546015,519535820,977695811,315462313,416814810,922366583,677409078,939326232,873148049,667805289,79330914,683439801,590079830,123330183,464946358,807759911,277898703,778673872,852620522,501033743,799000382,485740594,124346426,933457136,156808284,189043288,667618243,765409908,891713046,364191704,920062739,285606750,16413165,234261744,466647962,55170234,489117958,490447633,748221043,968370015,414616873,182799031,199326587,923407746,703819922,540007261,491209796,90042085,54046635,565895163,855899946,680690616,998848808,472385218,570297133,579429455,109400152,507994450,671316857,899530031,631744449,308990577,28357042,201025030,674825858,456186438,816633502,730845087,505857967,837852771,808307827,741285777,706559561,172463002,762256352,522878986,757560022,507904056,135899098,659085900,213172902,549634478,426888416,968121377,990359892,884054863,745331084,230691766,515385807,542327926,538996317,663149043,783592825,740048339,176979838,527090982,666971685,157469244,790212337,474078040,434108239,602651757,484812863,214657842,154173526,216340523,170028325,435101645,368610788,122759895,41204656,445331767,372904194,903749994,687217037,894574981,618926267,111870873,218838443,193267727,985965955,11066716,621103991,797911973,334170198,732217895,33398979,568497710,192784753,866915821,259089827,15902587,770148746,236118030,856184351,426136903,72178411,706550026,487789134,133559625,523100392,495368580,219229584,714875685,14625524,958520714,446000520,549533484,92896351,649267089,282403019,758381897,909018848,470520493,97140491,623796382,460375041,308334602,62354698,321794506,732113856,298228167,503688443,379006120,313759014,618104377,246161849,815502984,244821956,94817923,1007046,109003604,678370657,392689051,574321629,808513378,321036776,521985293,505832425,328406537,946617148,734136102,352567382,338401963,856741764,349479705,454812492,933986218,874254532,345054817,816171412,925982917,761184502,129196101,98746822,908830270,705930364,204326996,14975977,862647910,521153606,874919428,147896020,496496651,284498566,164087669,366515875,1343654,100560128,267597025,841374109,417193598,54121040,657390251,636047524,442309712,863262266,678177313,619275152,191500589,407957810,195827305,901588834,346507205,201007009,945287781,840452167,538708867,6420140,291786648,487947777,346048538,694570427,658439554,83710320,477258503,728694097,711442909,26138319,629210339,648518261,240781743,390161104,326306465,420939685,824782284,112377245,674606569,604761528,689758899,329377791,359541131,561983313,656446731,208526898,272178606,971816494,296420375,185858171,432561156,626797438,738081786,99853218,419173799,572668734,398268938,737260533,723080455,29260722,998538801,129645809,658799560,812696530,833267350,350882719,186448232,701643753,918835603,316981604,134522500,218381716,185147503,186159632,964591814,187328176,197914206,231945427,938719419,668260834,870877909,723704501,382310604,70062216,126336312,611411299,779711153,820502807,648690867,794093934,979917870,578687803,357578941,7901364,608404135,129240271,334163583,323347279,147891840,116090623,348806141,870902525,869805877,765262902,833726883,104894402,578512434,349733094,970648873,689395941,825769204,278015090,37687163,475234920,592577755,963176880,599756686,109659376,500795250,917483319,423592804,191082099,171730514,245950681,645976410,21511750,251615322,566596133,359014807,443596700,551170080,843274995,68790450,135541795,725412657,985451847,336300314,958368861,585396319,641589903,33207072,129858370,148347171,347899801,607129156,495137711,794301730,594362903,462717368,708969018,45260287,497894730,734951236,21057356,682987441,872278382,213686825,570301643,29630065,645176153,557716789,452835051,501155486,889606349,135610634,144909566,709060900,245944495,495918066,724241267,344809282,961068346,900469376,119803250,849085452,897727010,77904130,656194655,120494975,850014841,225369449,225251133,220578396,855300476,885855307,373686115,674379911,531622982,644871113,887939173,598851125,814894184,141687210,519818338,942643209,414267577,944310607,628091289,143089275,474131866,215756835,200116603,785791210,323245796,911806412,901737679,929452610,806551850,292812694,840962996,560994796,620847955,774652691,745624937,956399543,863665447,330750072,120248428,712786270,857173442,93292028,685728293,94050285,71364678,641440031,799787471,231370351,619511764,71762418,949998664,231764234,179051642,671518903,596035126,598127170,446996876,103551896,461880158,896521245,938745517,802301139,19114290,228711685,68280832,842567174,355507878,945733317,73920840,779492039,629904695,911882411,749398718,38196679,770498433,713561766,101075601,426834800,845098717,101472749,333216277,731315775,998163420,379762822,431908670,664300437,489817427,210393061,683292097,928218053,679608977,663291066,523027552,941195170,76054738,163811195,142716320,691592790,126234135,409959611,810741875,212724097,45340925,127816808,772912535,354863141,658380187,749240213,813114885,751330324,588897589,224519488,227844587,963043094,506064211,987730325,610389428,183606770,587225913,424305877,867771836,580084580,426028717,667449438,22223374,779752720,37166776,22334463,905966471,880324113,230133209,203317125,710600742,381844616,354715626,442038216,512799329,819465847,250263176,76240775,230497850,936906729,2002414,842010363,342493969,844418509,10799920,236957011,529926807,604718589,954402574,939776002,17738468,89240898,242863241,230661480,112330247,665127521,844573935,494175551,380447921,292216596,247402329,813807911,668288740,767941241,4000673,292486048,971699491,199524320,258012395,754506197,777832374,733829948,898249098,286133825,729829851,608118205,969574395,257727380,935914859,43484816,514935550,258791679,393109519,320709758,236577274,533085803,553483120,212964341,205990835,478620820,152965986,715701258,431434296,837203608,836676297,65937777,320637289,228300675,869330050,169799899,838900213,75268272,220160222,816815051,486755785,473847121,649000019,353787659,526427474,116448311,787199445,540025875,466279157,29867994,305634345,566230257,910235570,218928636,156353791,304053339,101131674,99473649,695403656,423371198,310502594,77967335,163619045,480245016,710540930,258752186,91245542,450504415,172651747,830953435,176672914,85042831,769853742,12690518,24946884,808758446,240968880,12230668,126738959,422174738,649018255,638054541,814265036,228713071,90911699,175689310,484968366,658106493,492381692,962446206,711316398,529145963,526113125,583379961,888620877,688141417,109880025,152939931,235320152};
		long start = System.nanoTime();
		Arrays.sort(test);
		long end = System.nanoTime();
		System.out.println((end - start)/1000000 + " milliseconds");
		*/
		  
	}

	public int numFactoredBinaryTrees(int[] arr) {
        //Use dynamic programming, determining how many trees can be made from each element
		
		HashMap<Integer,Long> trees = new HashMap<>();
		Arrays.sort(arr);
		long sum = 0;
		int length = arr.length;
		
		for (int i = 0; i < arr.length; i++) {
			sum += findTrees(arr[i],i,arr,trees);
			System.out.printf("%d of %d Sum:%d\n",i,length,sum);
		}
		System.out.println(sum);
		return (int) (sum % (int)(Math.pow(10, 9)+7));
    }
	
	public Long findTrees(int num,int index,int[] avail,Map<Integer,Long> trees) {
		
		if(trees.get(num) != null) {
			return trees.get(num);
		}			
		HashMap<Integer,FIndex> factors = new HashMap<>();
		
		for (int i = 0; i < index; i++) {
			if(avail[i] > num/2) {break;}
			for (int j = i; j < index; j++) {
				if(avail[j] > num/2) {break;}
				if(Math.multiplyExact((long)avail[i], (long)avail[j]) == num) {
				//if((long)avail[i] * (long)avail[j] == num) {
					factors.put(avail[i], new FIndex(i,avail[j],j));
					factors.put(avail[j], new FIndex(j,avail[i],i));
				}
			}
		}
		long sum = 1;
		for (Entry<Integer, FIndex> entry : factors.entrySet()) {
			sum += findTrees(entry.getKey(),entry.getValue().index,avail,trees) * findTrees(entry.getValue().factor,entry.getValue().fIndex,avail,trees);
		}
		trees.put(num, sum);
		return trees.get(num);
	}
}
